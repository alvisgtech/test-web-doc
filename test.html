<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building Locator with Haversine Formula</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .location {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .location h2 {
            margin: 0;
            font-size: 18px;
        }
        .location p {
            margin: 5px 0;
        }
        a {
            color: #007BFF;
            text-decoration: none;
        }
        .user-location {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>

<h1>Available Buildings</h1>
<div id="userLocation" class="user-location"></div>
<div id="locations"></div>

<script>
    var buildings = [
        {name: "HDB", lat: 1.3326157210856786, lon: 103.84792891104003, seatsAvailable: 5, deeplink: "https://app.workpal.gov.sg/miniapp?module=resource"}, // Central Singapore
        {name: "Building 2", lat: 1.3644, lon: 103.9915, seatsAvailable: 8, deeplink: "myapp://building2"}, // Pasir Ris
        {name: "Building 3", lat: 1.2839, lon: 103.8514, seatsAvailable: 0, deeplink: "myapp://building3"}, // Marina Bay Sands
        {name: "Building 4", lat: 1.3776, lon: 103.7641, seatsAvailable: 12, deeplink: "myapp://building4"}  // Woodlands
    ];

    function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
        var R = 6371; // Radius of the earth in km
        var dLat = deg2rad(lat2 - lat1);
        var dLon = deg2rad(lon2 - lon1);
        var a = Math.sin(dLat / 2) * Math.sin(dLon / 2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c; // Distance in km
    }

    function deg2rad(deg) {
        return deg * (Math.PI / 180);
    }

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var userLat = position.coords.latitude;
            var userLon = position.coords.longitude;

            // Display user's current latitude and longitude
            var userLocationDiv = document.getElementById("userLocation");
            userLocationDiv.innerHTML = `<strong>Your Location:</strong> Latitude: ${userLat}, Longitude: ${userLon}`;

            // Calculate distance for each building
            buildings.forEach(function(building) {
                building.distance = getDistanceFromLatLonInKm(userLat, userLon, building.lat, building.lon);
            });

            // Sort buildings by distance (ascending order)
            buildings.sort(function(a, b) {
                return a.distance - b.distance;
            });

            // Display the sorted list of buildings
            var locationContainer = document.getElementById("locations");
            buildings.forEach(function(building) {
                var locationDiv = document.createElement("div");
                locationDiv.className = "location";
                locationDiv.innerHTML = `
                    <h2>${building.name}</h2>
                    <p>Seats available: ${building.seatsAvailable}</p>
                    <p>Distance: ${building.distance.toFixed(2)} km</p>
                    <p><a href="${building.deeplink}">Book Now</a></p>
                `;
                locationContainer.appendChild(locationDiv);
            });

        }, function(error) {
            alert("Geolocation failed: " + error.message);
        });
    } else {
        alert("Geolocation is not supported by this browser.");
    }
</script>

</body>
</html>
